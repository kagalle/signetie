package gaeAccessToken_test

// https://medium.com/@matryer/5-simple-tips-and-tricks-for-writing-unit-tests-in-golang-619653f90742#.pmtojriju
// http://localhost:6060/pkg/github.com/stretchr/testify/assert

import (
	"encoding/json"
	"strings"
	"testing"

	"github.com/kagalle/signetie/client_golang/gae/gaeAccessToken"
	"github.com/stretchr/testify/assert"
)

func TestJsonDecoder(t *testing.T) {
	const jsonStream = `{
 "access_token": "ya29.Ci_MA4Lnj4lHjQ8pthfD-WmM3V5YfkA_JK46clAiWJT4W15KYnS2sk2FGo5cW1MEWg",
 "token_type": "Bearer",
 "expires_in": 3600,
 "refresh_token": "1/d1MJUZf-nyehOT4-pzXIOMDR6JlE9v1eoy9msnipkQBhZtz0uKThk21Z-jgbCom3",
 "id_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjAxMjg1OGI1YTZiNDQ3YmY4MDdjNTJkOGJjZGQyOGMwODJmZjc4MjYifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJpYXQiOjE0ODM4Mjc2MTIsImV4cCI6MTQ4MzgzMTIxMiwiYXRfaGFzaCI6InJ1VG1GMVNRZG1qcjMxZjJkRUlVTVEiLCJhdWQiOiIxOTI4MjA2MjEyMDQtbnJrdW0xOWd0OGE3aGpycmtyZHBkaGgycWdtaTB0b3EuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMDk4ODI0NzY0ODQyNzA1NjYyOTgiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXpwIjoiMTkyODIwNjIxMjA0LW5ya3VtMTlndDhhN2hqcnJrcmRwZGhoMnFnbWkwdG9xLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiZW1haWwiOiJyYWluc2hvd2Vycy5vcmdAZ21haWwuY29tIiwibmFtZSI6Iktlbm5ldGggR2FsbGUiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDQuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy0wMVFJaUo5cUFmYy9BQUFBQUFBQUFBSS9BQUFBQUFBQUFEYy9xVWtnZ0dmWEdFWS9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiS2VubmV0aCIsImZhbWlseV9uYW1lIjoiR2FsbGUiLCJsb2NhbGUiOiJlbiJ9.G-ePRtE6M1kIS4MaonhSLQGlaVgV_BVMZw03Itx1lRBwu7Uc_sPPctq290T4SXrzWny762m60O0IU7nZprznnHXPLIIM0ZRIV-kDLY9A_D9URDDlXSe6h6o3pnbuTgTPMsHfsRuUf54VYie6ICTvbJjEQcx81ucYWgAsRIg2MVw8HWqSCmt6nEkVCwFLsqg6fJMbJP_yDef7nlZLFUDQ4hzT0qg7TzpRYXDf-JxkXajUCnSVYC9VIFZrhh25qPEGDMXP9Q7y-0BqoaBhY7_EWZsdweoklAxuUjVE85fxhe-4RDIs3IQXaTrGQ68BRie5V5wXX7QuQ2Ck59C1x-M9zA"
}`
	var expectedResponse = gaeAccessToken.ResponseData{
		AccessToken:  "ya29.Ci_MA4Lnj4lHjQ8pthfD-WmM3V5YfkA_JK46clAiWJT4W15KYnS2sk2FGo5cW1MEWg",
		TokenType:    "Bearer",
		ExpiresIn:    3600,
		RefreshToken: "1/d1MJUZf-nyehOT4-pzXIOMDR6JlE9v1eoy9msnipkQBhZtz0uKThk21Z-jgbCom3",
		IDToken:      "eyJhbGciOiJSUzI1NiIsImtpZCI6IjAxMjg1OGI1YTZiNDQ3YmY4MDdjNTJkOGJjZGQyOGMwODJmZjc4MjYifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJpYXQiOjE0ODM4Mjc2MTIsImV4cCI6MTQ4MzgzMTIxMiwiYXRfaGFzaCI6InJ1VG1GMVNRZG1qcjMxZjJkRUlVTVEiLCJhdWQiOiIxOTI4MjA2MjEyMDQtbnJrdW0xOWd0OGE3aGpycmtyZHBkaGgycWdtaTB0b3EuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMDk4ODI0NzY0ODQyNzA1NjYyOTgiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXpwIjoiMTkyODIwNjIxMjA0LW5ya3VtMTlndDhhN2hqcnJrcmRwZGhoMnFnbWkwdG9xLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiZW1haWwiOiJyYWluc2hvd2Vycy5vcmdAZ21haWwuY29tIiwibmFtZSI6Iktlbm5ldGggR2FsbGUiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDQuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy0wMVFJaUo5cUFmYy9BQUFBQUFBQUFBSS9BQUFBQUFBQUFEYy9xVWtnZ0dmWEdFWS9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiS2VubmV0aCIsImZhbWlseV9uYW1lIjoiR2FsbGUiLCJsb2NhbGUiOiJlbiJ9.G-ePRtE6M1kIS4MaonhSLQGlaVgV_BVMZw03Itx1lRBwu7Uc_sPPctq290T4SXrzWny762m60O0IU7nZprznnHXPLIIM0ZRIV-kDLY9A_D9URDDlXSe6h6o3pnbuTgTPMsHfsRuUf54VYie6ICTvbJjEQcx81ucYWgAsRIg2MVw8HWqSCmt6nEkVCwFLsqg6fJMbJP_yDef7nlZLFUDQ4hzT0qg7TzpRYXDf-JxkXajUCnSVYC9VIFZrhh25qPEGDMXP9Q7y-0BqoaBhY7_EWZsdweoklAxuUjVE85fxhe-4RDIs3IQXaTrGQ68BRie5V5wXX7QuQ2Ck59C1x-M9zA"}
	decoder := json.NewDecoder(strings.NewReader(jsonStream)) // resp.Body)
	// ResponseData is defined in codetoken.go
	var jsonResponse gaeAccessToken.ResponseData
	err := decoder.Decode(&jsonResponse)
	if assert.NoError(t, err) {
		assert.Equal(t, jsonResponse, expectedResponse)
	}
}
